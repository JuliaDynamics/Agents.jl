<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Zombie Outbreak · Agents.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Agents.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Agents.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../tutorial/">Tutorial</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../schelling/">Schelling&#39;s segregation model</a></li><li><a class="tocitem" href="../sir/">SIR model for the spread of COVID-19</a></li><li><a class="tocitem" href="../flock/">Flocking</a></li><li class="is-active"><a class="tocitem" href>Zombie Outbreak</a><ul class="internal"><li><a class="tocitem" href="#Constructing-the-end-of-days"><span>Constructing the end of days</span></a></li><li><a class="tocitem" href="#Visualising-the-fall-of-humanity"><span>Visualising the fall of humanity</span></a></li></ul></li><li><a class="tocitem" href="../rabbit_fox_hawk/">Rabbit, Fox, Hawk</a></li><li><a class="tocitem" href="../../models/">Predefined Models</a></li><li><a class="tocitem" href="../">More Examples for Agents.jl</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../interact/">Plotting and interactive application</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Ecosystem Integration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../optim/">BlackBoxOptim.jl</a></li><li><a class="tocitem" href="../diffeq/">DifferentialEquations.jl</a></li><li><a class="tocitem" href="../schoolyard/">Graphs.jl</a></li><li><a class="tocitem" href="../measurements/">Measurements.jl</a></li></ul></li><li><a class="tocitem" href="../../performance_tips/">Performance Tips</a></li><li><a class="tocitem" href="../../comparison/">ABM Framework Comparison</a></li><li><a class="tocitem" href="../../devdocs/">Developer Docs</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Zombie Outbreak</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Zombie Outbreak</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDynamics/Agents.jl/blob/master/examples/zombies.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Zombie-Outbreak"><a class="docs-heading-anchor" href="#Zombie-Outbreak">Zombie Outbreak</a><a id="Zombie-Outbreak-1"></a><a class="docs-heading-anchor-permalink" href="#Zombie-Outbreak" title="Permalink"></a></h1><video width="auto" controls autoplay loop>
<source src="https://raw.githubusercontent.com/JuliaDynamics/JuliaDynamics/master/videos/agents/zombies.mp4?raw=true" type="video/mp4">
</video><p>This model showcases an ABM running on a map, using <a href="../../api/#Agents.OpenStreetMapSpace"><code>OpenStreetMapSpace</code></a>.</p><h2 id="Constructing-the-end-of-days"><a class="docs-heading-anchor" href="#Constructing-the-end-of-days">Constructing the end of days</a><a id="Constructing-the-end-of-days-1"></a><a class="docs-heading-anchor-permalink" href="#Constructing-the-end-of-days" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Agents</code></pre><p>We&#39;ll simulate a zombie outbreak in a city. To do so, we start with an agent which satisfies the OSMSpace conditions of having a <code>pos</code>ition of type <code>Tuple{Int,Int,Float64}</code>. For simplicity though we shall build this with the <a href="../../api/#Agents.@agent"><code>@agent</code></a> macro.</p><pre><code class="language-julia hljs">@agent Zombie OSMAgent begin
    infected::Bool
end</code></pre><p>To be explicit, this macro builds the following type:</p><pre><code class="language-julia hljs">mutable struct Zombie &lt;: AbstractAgent
    id::Int
    pos::Tuple{Int,Int,Float64}
    infected::Bool
end</code></pre><p>where a tuple <code>(i, j, x)::Tuple{Int,Int,Float64}</code> means a position on the road between nodes <code>i, j</code> of the map, having progressed <code>x</code> distance along the road.</p><p>The model constructor we build consists of a map, and 100 agents scattered randomly around it. They have their own agenda and need to travel to some new destination. Unfortunately one of the population has turned and will begin infecting anyone who comes close.</p><pre><code class="language-julia hljs">function initialise(; map_path = OSM.test_map())
    model = ABM(Zombie, OpenStreetMapSpace(map_path))

    for id in 1:100
        start = random_position(model) # At an intersection
        human = Zombie(id, start, false)
        add_agent_pos!(human, model)
        OSM.random_route!(human, model; limit = 50) # try 50 times to find a random route
    end
    # We&#39;ll add patient zero at a specific (latitude, longitude)
    start = OSM.road((51.5328328, 9.9351811), model)
    finish = OSM.intersection((51.530876112711745, 9.945125635913511), model)
    zombie = add_agent!(start, model, true)
    plan_route!(zombie, finish, model)
    # This function call creates &amp; adds an agent, see `add_agent!`
    return model
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">initialise (generic function with 1 method)</code></pre><p>In our model, zombies are seemingly oblivious to their state, since they keep going about their business, but start eating people along the way. Perhaps they can finally express their distaste for city commuting.</p><pre><code class="language-julia hljs">function agent_step!(agent, model)
    # Each agent will progress slightly along their route
    move_along_route!(agent, model, 0.005)

    if is_stationary(agent, model) &amp;&amp; rand(model.rng) &lt; 0.1
        # When stationary, give the agent a 10% chance of going somewhere else
        OSM.random_route!(agent, model; limit = 50)
        # Start on new route
        move_along_route!(agent, model, 0.0001)
    end

    if agent.infected
        # Agents will be infected if they get too close to a zombie.
        map(i -&gt; model[i].infected = true, nearby_ids(agent, model, 0.0003))
    end
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">agent_step! (generic function with 1 method)</code></pre><h2 id="Visualising-the-fall-of-humanity"><a class="docs-heading-anchor" href="#Visualising-the-fall-of-humanity">Visualising the fall of humanity</a><a id="Visualising-the-fall-of-humanity-1"></a><a class="docs-heading-anchor-permalink" href="#Visualising-the-fall-of-humanity" title="Permalink"></a></h2><p>Plotting this space in a seamless manner is a work in progress. For now we use <a href="https://github.com/fbanning/OSMMakie.jl">OSMMakie.jl</a> and a custom routine.</p><p>using OSMMakie</p><pre><code class="language-julia hljs">using CairoMakie
ac(agent) = agent.infected ? :green : :black
as(agent) = agent.infected ? 6 : 5

model = initialise()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AgentBasedModel with 101 agents of type Zombie
 space: OpenStreetMapSpace with 401 ways and 1483 nodes
 scheduler: fastest</code></pre><p>fig, ax, plot = osmplot(model.space.map)</p><pre><code class="language-julia hljs">ids = model.scheduler(model)
colors = Node([ac(model[i]) for i in ids])
sizes = Node([as(model[i]) for i in ids])
marker = :circle
pos = Node(Point2f[OSM.latlon(model[i].pos, model) for i in ids])
fig, _= scatter(pos; color = colors, size = sizes, marker)

record(fig, &quot;outbreak.mp4&quot;, 1:200; framerate = 15) do i
    Agents.step!(model, agent_step!, 1)
    ids = model.scheduler(model)
    colors[] = [ac(model[i]) for i in ids]
    sizes[] = [as(model[i]) for i in ids]
    pos[] = Point2f[OSM.latlon(model[i].pos, model) for i in ids]
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;outbreak.mp4&quot;</code></pre><video width="auto" controls autoplay loop>
<source src="../outbreak.mp4" type="video/mp4">
</video></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../flock/">« Flocking</a><a class="docs-footer-nextpage" href="../rabbit_fox_hawk/">Rabbit, Fox, Hawk »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Friday 7 January 2022 23:03">Friday 7 January 2022</span>. Using Julia version 1.7.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
